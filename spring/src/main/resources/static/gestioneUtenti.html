<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Admin - Gestione Utenti</title>
    <script>
    async function getUtenti() {
        let url = "http://localhost:8080/utente/getUtenti";
        try {
            let response = await fetch(url);
            return await response.json();
        } catch (error) {
            console.log("Errore nella fetch:", error);
            return [];
        }
    }

    async function caricaUtenti() {
        const utenti = await getUtenti();
        const container = document.getElementById("listaUtenti");
        container.innerHTML = ""; // pulisce

        utenti.forEach(u => {
            const div = document.createElement("div");
            div.textContent = `ID: ${u.id}, Username: ${u.username}, Ruolo: ${u.ruolo}`;
            container.appendChild(div);
        });
    }

    async function doRegistrazione() {
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;
        let ruolo = document.getElementById("ruolo").value;

        let risposta = await registraUtente(username, password,ruolo);

        if(risposta["esito"] === "ok") {
            alert("registrazione fatta con successo");
            window.location.href = "login.html";
        } else {
            alert("registrazione fallita");
        }
    }

    window.onload = caricaUtenti;
    </script>
</head>
<body>
    <h1>Gestione Utenti - Admin</h1>

    <h2>Lista Utenti</h2>
    <div id="listaUtenti" style="margin-bottom: 30px;"></div>

    <h2>Aggiungi Utente</h2>
        <label>Username: <input type="text" id="username" required></label><br>
        <label>Password: <input type="password" id="password" required></label><br>
        <label>Ruolo:
            <select id="ruolo">
                <option value="ADMIN">ADMIN</option>
                <option value="CLIENTE">CLIENTE</option>
            </select>
        </label><br>
        <button onclick="doRegistrazione()" class="btn btn-primary w-100">Accedi</button>
</body>
</html>
